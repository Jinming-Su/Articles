### ABSTRACT
软件定义网络（SDN）是一种新的网络模式，具有很大的潜力提高网络效率，缓解网络控制和管理的复杂性，加快技术创新速度。 SDN的核心概念之一是网络控制和数据平面的分离。网络操作和管理（如路由）的智能和控制从转发元件（交换机）中被去除，并且集中在逻辑上集中的组件，即SDN控制器。为了控制器配置和管理网络，它需要有关于网络状态的最新信息，特别是其拓扑。因此，拓扑发现是任何软件定义网络架构的重要组成部分。在本文中，我们评估了主要SDN控制器框架目前实现的拓扑发现的实际标准方法的成本和开销，并提出了实现显着提高效率和降低控制开销的简单实用的修改。我们已经在广泛使用的POX控制器平台上实现了我们的新的拓扑发现方法，并通过使用Mininet网络仿真器的实验，对一系列网络拓扑进行了评估。我们的研究结果表明，与目前最先进的方法相比，我们提出的修改可以降低控制器负载的45％，同时提供相同的发现功能。  

### I. INTRODUCTION
软件定义网络（SDN）是一种新的网络模式，近期在商业活动和学术研究方面取得了巨大的发展[1]，[2]，[3]。  
SDN的关键概念之一是数据平面与控制平面的分离。这与传统的IP网络形成对比，传统IP网络在路由器执行数据包转发（data plane）和运行发现网络路径并进行路由决策（控制平面）的路由协议。在SDN中，控制“智能”从转发元件（路由器，交换机）中移除，并集中在一个称为SDN控制器的逻辑集中式实体中，由软件实现。  
控制的逻辑集中并不一定意味着物理中心化，这可能导致可扩展性和可靠性问题，因为SDN控制器将代表单点故障。为了解决这个问题，研究人员提出了物理分布式的SDN控制器，例如Onix系统[4]。  
通过网络控制的集中化，SDN基本上取消了传统的分布式网络协议。因此，以下简称为交换机的SDN转发元件可以比传统路由器变得更简单和便宜，并且网络配置和管理被显着简化。  
使用SDN，网络变得更加可编程，并实现更高的创新速度。新的网络服务，应用和策略可以通过在控制器上运行的应用程序来实现，该应用程序通过适当的抽象和明确定义的API（如OpenFlow [5]）来控制转发元素（数据平面）。通过安装适当的规则，控制器应用程序可以对SDN交换机进行编程，以执行广泛的功能，如路由，交换，防火墙，网络地址转换，负载均衡等。这可以在协议栈的不同层进行。  
SDN的另一个关键好处是其能够促进网络虚拟化，例如通过诸如FlowVisor [6]或OpenVirteX [7]等工具，这在许多部署场景中尤为重要，特别是在数据中心应用中。 SDN的这些优点和其他好处已经导致了近期行业的巨大牵引力，许多成熟的新厂商提供了越来越多的支持SDN的交换机和其他设备，以及一系列SDN控制器平台。  
图1显示了基本SDN架构的逻辑视图。底部是由提供数据平面功能的一组相互连接的转发元件即SDN交换机组成的基础设施层。交换机既可以是硬件设备，也可以是基于软件的虚拟交换机，如Open vSwitch [8]。  
下一层是控制层，由逻辑集中的基于软件的SDN控制器组成。控制器的关键角色之一是提供和维护网络的全局视图。 SDN控制器为应用层提供了一个抽象，隐藏了维护和配置单个网络设备分布式网络的大量复杂性。拓扑发现，本文的重点是SDN控制层提供的基本服务。  
为了实现这一抽象，SDN控制器负责通过安装适当的转发规则来管理和配置各个SDN交换机。控制层和用于此的基础设施层之间的接口通常被称为南向接口。  
最突出的南行接口标准是OpenFlow [5]，[9]，我们将在本文中假设和使用。第二部分将提供一些关于OpenFlow的更多细节，这些细节与本文后面讨论的相关。  
SDN架构的顶层是应用层，其中定义和实现了高级别的网络策略决策。应用层和控制层之间的接口称为北向接口。然而，与南行接口相反，北行接口的标准定义仍然是一项正在进行的工作。  
在本文中，我们专注于拓扑发现，这是SDN架构控制层提供的关键服务，支持SDN的集中配置和管理。本文的贡献包括对现有SDN拓扑发现实际标准的开销进行分析。我们进一步提出一个改进的版本，其设计能够以显着降低的控制器负载来实现相同的功能。我们提出了证明这一点的实验评估结果。  
作为我们以下讨论的基础，第二部分介绍了OpenFlow的相关背景。第三节讨论了SDN中现有的拓扑发现方法，第四部分介绍了我们提出的新方法。第五节和第六节分别提出了评估结果和结论。  

### BACKGROUND - O PEN F LOW
OpenFlow [9]是SDN南向接口的标准协议，即图1中控制层与基础设施层之间的接口。实际上，Open Flow提供了SDN控制器和SDN交换机之间的通信接口，允许控制器配置和管理交换机。  
虽然提出并采用其他协议作为南向接口，如SNMP，BGP，PCEP等。[10] Open开放网络基金会（ONF）推出的OpenFlow [3]是主流标准。  
在撰写本文时，最新版本的OpenFlow标准是1.4版[11]。 OpenFlow已经从其初始版本（1.0）到当前版本进行了一些更改。然而，各种协议版本之间的差异在本文的上下文中并不重要。我们对拓扑发现机制的讨论和我们提出的改进是协议版本不可知，并且适用于所有版本的协议。  
假定启用OpenFlow的SDN交换机配置了其控制器的IP地址和TCP端口号。在启动时，交换机将在相应的IP地址和TCP端口上联系其控制器，并建立传输层安全（TLS）f会话来保护连接。  
作为初始协议握手的一部分，使用Open Flow OFPT FEATURES REQUEST消息，控制器从交换机请求配置信息，包括其活动交换机端口（网络接口）和相应的MAC地址。我们将在第四节中提出的拓扑发现方法中使用这一点。初始交换机控制器握手通知控制器网络中节点（交换机）的存在，但完整拓扑视图缺少的是有关网络中交换机之间可用链路的信息。这通过本文后面讨论的拓扑发现机制来解决。  
OpenFlow允许控制器访问和操纵SDN交换机的转发规则，从而控制流量如何流经网络。符合OpenFlow的交换机需要支持基本的匹配动作范例，这意味着每个传入的数据包都与一组规则进行匹配，并且执行与匹配规则关联的操作或操作列表。匹配是基于流的，并且相对细粒度。 OpenFlow支持的匹配字段包括交换机入口端口，各种数据包头域，如MAC源和目标地址，IP源和目标地址，UDP / TCP源和目的地端口号等。OpenFlow支持的关键操作之一交换机将数据包转发到特定交换机端口，或丢弃数据包。  
转发规则中定义的交换机端口包括物理端口，还包括以下虚拟端口：ALL（在所有物理端口上发送数据包），CONTROLLER（通过OpenFlow Packet-In消息发送到SDN控制器），FLOOD（与ALL ，但不包括入口端口）。  
此外，OpenFlow还支持多种操作，允许交换机重写数据包头，包括更新TTL字段，添加或删除VLAN和MPLS标签，重写MAC源和目标地址等。将在第四节讨论的我们提出的拓扑发现机制中利用这一特征。在这种情况下，请注意，由于性能原因，OpenFlow不支持访问和重写任何数据包有效负载。  
交换机还可以将其通过其任何端口接收的数据分组转发到控制器。这是通过Open Flow Packet-In消息（OFPT PACKET IN）完成的。例如，每当交换机接收到与任何转发规则不匹配的数据包时，都会使用此操作。在这种情况下，默认行为是交换机将数据包转发到OpenFlow Packet-In消息中分配的控制器encap。然后，控制器可以决定为相应的新流程安装适当的转发规则。  
数据包转发到控制器也可以通过安装在交换机上的专用规则来实现。例如，在当前的事实上的标准SDN拓扑发现机制中，下面更详细的讨论，每个交换机都有一个预先安装的规则，表示所有的拓扑发现数据包（EtherType 0x88cc）都要转发到CONTROLLER端口。  
与Packet-In原语相辅相成，OpenFlow还支持分组消息（OFPT PACKET OUT）。 通过该消息，控制器可以以动作列表的形式向交换机发送数据分组，并具有如何处理。 例如，控制器可以向交换机发送数据包，并指示将其发送到特定端口。 或者，控制器可以通过OFPP TABLE虚拟输出端口指示交换机发送分组，这意味着分组被视为通过任何交换机的“正常”端口接收到的数据包，并根据正常的转发规则进行处理 （或流表）安装在交换机上。  
OpenFlow分组输入和分组输出消息对于以下部分中讨论的拓扑发现机制至关重要。  

### SDN TOPOLOGY DISCOVERY - CURRENT APPROACH
为了使SDN控制器能够管理网络并提供诸如路由的服务，它需要具有关于网络状态，特别是网络拓扑的最新信息。因此，可靠且高效的拓扑发现机制对于任何SDN系统至关重要。
具体来说，当我们在下面引用拓扑发现时，我们真的关心连接发现或链接发现。 SDN控制器不需要发现网络节点（交换机），因为它们假设它们将启动到控制器的连接，从而宣布它们的存在。  
OpenFlow交换机不支持用于拓扑发现的任何专用功能，并且由控制器负责实施此服务。此外，在基于OpenFlow的SDN中没有定义拓扑发现方法的官方标准。然而，大多数当前的控制器平台以相同的方式实现拓扑发现，源自NOX [12]（原始SDN控制器）的实现。这使得该机制成为事实上的SDN拓扑发现标准。该机制在[13]中称为OFDP（OpenFlow Discovery Protocol），由于缺少官方术语，我们将在本文中使用该名称。  
OFDP利用链路层发现协议（LLDP）[14]。 LLDP允许IEEE 802局域网中的节点向其他节点通告其能力和邻居。  
LLDP通常由以太网交换机实现，主动发送和接收LLDP报文。 LLDP数据包经过交换机的每个端口定期发送，寻址到网桥过滤的组播地址，因此不会被交换机转发，而只能通过单跳发送。  
从接收的LLDP数据包中学到的信息由本地管理信息库（MIB）中的所有交换机存储。通过爬行网络中的所有节点并检索MIB中的相应信息，例如，通过SNMP，网络管理系统可以发现网络拓扑。  
LLDP有效载荷封装在EtherType字段设置为0x88cc的以太网帧中。该帧包含一个LLDP数据单元（LLDPDU），它由多个类型长度值（TLV）结构组成。强制TLV是机箱ID，它是唯一的交换机标识符，端口ID和生存时间，这是不言自明的，后面是多个可选TLV和LLDPDU结束TLV。图2显示了帧结构，LLDP有效载荷被突出显示。  
OFDP利用LLDP的数据包格式，但是其他方式的运作方式也是截然不同的。鉴于其相当窄的API和有限的匹配操作功能，OpenFlow交换机本身不能发送，接收和处理LLDP消息。这需要由控制器完全启动和执行。该过程在图3所示的非常简单的情况下进行了说明。  
首先在这种情况下，SDN控制器为每个交换机上的每个端口创建单独的LLDP数据包，在这种情况下，端口1的数据包，端口2的数据包，交换机S1的端口3。这三个LLDP数据包中的每一个都相应地初始化了机箱ID和端口ID TLV。  
控制器然后通过单独的OpenFlow分组消息将这三个LLDP分组中的每一个发送给交换机S1，其中包含的指令在相应端口上发送分组。例如，端口ID =端口1的LLDP报文将在端口1发送，端口号为Port 2的端口号为2的报文等等。  
所有交换机在其流表中都有预先安装的规则，其中说明从CONTROLLER端口以外任何端口接收的任何LLDP数据包都将转发到控制器，控制器通过OpenFlow Packet-In消息完成。  
在我们在图3的例子中，我们考虑了在交换机S1的端口1上发送的LLDP分组，并且由交换机S2经由端口3经由到相应的链路来接收。  
根据预先安装的转发规则，交换机S2经由Packet-In消息将收到的LLDP报文转发给控制器。该分组输入消息还包含元数据，例如交换机的ID和接收分组的入口端口。从该信息和从包含在LLDP分组的有效载荷（即，机箱ID和端口ID TLV）中的信息，控制器现在可以推断出在（S1，端口1）和（S2，端口3）之间存在链路，并将信息添加到其拓扑数据库。  
对于网络中的每个交换机重复该过程，即控制器为每个交换机的每个端口发送具有专用LLDP分组的单独分组消息消息，从而允许其发现网络中的所有可用链路。 周期性地执行整个删除过程，以固定间隔开始新的发现循环或周期，典型的默认间隔大小为5秒。  
最新的SDN控制器平台实现了这种拓扑发现机制（OFDP），如NOX [12]，POX [15]，Floodlight [16]，Ryu [17]，Beacon [18]等。 拓扑发现实现揭示了一些非常小的变化，主要是关于消息发送的时序。 POX（和NOX）将在发现间隔内平均发送所有LLDP分组消息。 相比之下，Floodlight在发现间隔开始时将背靠背发送所有这些消息，而Ryu在消息之间增加了一小段不间断的差距。  
  
##### Controller Overhead of OFDP
控制器负载和性能对于软件定义网络的能力至关重要[19]。由于拓扑发现是通常在所有SDN控制器的背景下连续运行的服务，因此了解其对控制器的负载非常重要。由于OFDP导致的控制器负载由控制器需要发送的LLDP Packet-Out消息的数量及其接收并需要处理的LLDP Packet-In消息的数量决定。  
控制器在单个发现回合中接收的LLDP分组消息（P IN OF DP）的数量取决于网络拓扑，并且仅为网络中活动交换机间链路数量的两倍，每个链路一个分组方向。  
控制器需要根据每个OFDP发现一次发送的LLDP分组消息（P OU T OF DP）的总数是网络中的总端口数。如本节前面所述，控制器需要向每个单独的端口发送具有相应端口ID和机箱ID的专用LLDP数据包。  
由于L是网络中交换机之间的链路数量，N是交换机的数量，p i是交换机i的端口数量，可以表示如下：xxx  
为每个交换机上的每个端口发送LLDP分组消息似乎效率低下。一个更好的选择是仅向每个交换机发送单个分组消息，并要求它在其所有端口上发送相应的LLDP分组。   OpenFlow支持此功能。  
问题是每个LLDP包需要将端口ID TLV初始化为相应的交换机出口端口。这是必需的，使得控制器在从接收交换机经由分组输入消息接收到LLDP分组时，可以确定所发现的链路的源端口。 （如图3所示）  
目前在OFDP中实现此目的的方法是控制器通过单独的分组消息为每个交换机的每个端口准备和发送专用的LLDP数据包。  
解决问题的方法是，如果我们能够指示交换机根据发送数据包的端口即时重写LLDP端口ID TLV。然而，这是不可能的，因为OpenFlow交换机不支持访问和重写数据包有效载荷数据。在下一节中，我们提出了解决这个问题的方法。  
 
### PROPOSED IMPROVEMENT - OFDPV2
为了实现将每个交换机的LLDP分组消息数量减少到一个目的，我们使用这样的事实，即在OpenFlow交换机和控制器之间建立连接时，交换机向控制器通知其端口，其端口ID和 响应于OpenFlow OFPT FEATURES REQUEST消息的关联MAC地址。 因此，控制器具有每个交换机的MAC地址和端口ID的一对一映射。  
我们使用的第二个功能是OpenFlow交换机重写数据包头的能力。 这通常用于更新TTL字段，实现网络地址转换等。特别地，我们将使用交换机可以重写传出以太网帧的源MAC地址的事实。  
我们提出的新的SDN拓扑发现方法（称为OFDPv2）涉及对当前版本（OFDP）的以下更改：
1）我们修改控制器行为，将发送到每个交换机的LLDP分组消息数量限制为一个。 LLDP有效载荷中的端口ID TLV字段设置为0，将被忽略。  
2）在每个交换机上安装新规则，指定从控制器收到的每个LLDP报文都将在所有可用端口上转发，并将相应的以太网帧的源MAC地址设置为 发送出去的端口（算法1）。
3）最后，我们修改控制器上的Packet-In事件处理程序，该处理器处理传入的LLDP数据包。 现在我们来看看以太网报头的源MAC地址，并且在控制器的数据库中查找对应的端口号，而不是分析LLDP有效载荷的端口ID TLV，而是与MAC地址和交换机端口进行一一对应的映射标识。  
xxx(算法1)  
如上所述，算法1示出了每个交换机上修改的LLDP分组处理，即它显示了所安装的匹配动作规则。  
如果传入的分组是LLDP分组（EtherType = 0x88cc），并且经由分组消息（inPort = CONTROLLER）从控制器接收到，则在每个交换机端口（线路5）上发送分组的副本， 源MAC地址已经被设置为要发送出去的端口的MAC地址（第4行）。  
OpenFlow不支持在算法1中使用的循环结构。因此，我们需要“展开”循环，并为每个交换机端口安装一个特定的操作列表。  
